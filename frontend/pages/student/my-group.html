<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Group | Niners.uz</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../styles/main.css">
</head>

<body>
    <div class="dashboard-grid">
        <div id="sidebarContainer"></div>
        <main class="main-content">
            <header style="margin-bottom: 32px;">
                <h2 id="classNameDisplay">Loading...</h2>
                <p style="color: var(--text-muted);" id="teacherNameDisplay">Your Teacher: Loading...</p>
            </header>

            <div class="card"
                style="background: white; padding: 24px; border-radius: var(--radius-lg); box-shadow: var(--shadow-soft);">
                <h3 style="margin-bottom: 20px;">Classmates</h3>
                <div id="classmatesList"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px;">
                    <!-- Classmates will be loaded here -->
                </div>
            </div>

            <div id="groupTopics" style="margin-top: 32px;">
                <h3 style="margin-bottom: 20px;">Recent Topics</h3>
                <div id="topicsList">
                    <!-- Topics will be loaded here -->
                </div>
            </div>
        </main>
    </div>

    <script src="../../js/translations.js"></script>
    <script src="../../js/api.js"></script>
    <script src="../../js/sidebar-loader.js"></script>
    <script>
        async function loadGroupData() {
            try {
                const data = await api.get('/student/my-class');
                document.getElementById('classNameDisplay').innerText = data.class_name;
                document.getElementById('teacherNameDisplay').innerText = `Teacher: ${data.teacher_name}`;

                const list = document.getElementById('classmatesList');
                list.innerHTML = data.classmates.map(c => `
                    <div style="background: #F8F9FA; padding: 16px; border-radius: 12px; display: flex; align-items: center; gap: 12px; border: 1px solid #EEE;">
                        <div style="width: 40px; height: 40px; background: ${c.is_me ? 'var(--primary-gradient)' : '#DDD'}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">
                            ${c.full_name[0]}
                        </div>
                        <div>
                            <div style="font-weight: 600;">${c.full_name} ${c.is_me ? '(You)' : ''}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">${c.rank}</div>
                        </div>
                    </div>
                `).join('');

                // Load Topics as well
                const topics = await api.get('/student/my-group/topics');
                const tList = document.getElementById('topicsList');
                if (topics.length === 0) {
                    tList.innerHTML = '<p style="color: var(--text-muted);">No topics added yet.</p>';
                } else {
                    tList.innerHTML = topics.map(t => `
                        <div class="card" style="margin-bottom: 12px; padding: 16px; background: white;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <div>
                                    <h4 style="margin: 0 0 4px 0;">${t.title}</h4>
                                    <p style="margin: 0; font-size: 0.9rem; color: #555;">${t.content}</p>
                                </div>
                                <span style="font-size: 0.75rem; color: var(--text-muted);">${t.date}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (e) {
                console.error(e);
                alert("Guruh ma'lumotlarini yuklashda xatolik yuz berdi.");
            }
        }

        document.addEventListener('DOMContentLoaded', loadGroupData);
    </script>
</body>

</html>